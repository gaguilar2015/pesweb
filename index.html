<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>PES Matching</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="pes_files/libs/clipboard/clipboard.min.js"></script>
<script src="pes_files/libs/quarto-html/quarto.js"></script>
<script src="pes_files/libs/quarto-html/popper.min.js"></script>
<script src="pes_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="pes_files/libs/quarto-html/anchor.min.js"></script>
<link href="pes_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="pes_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="pes_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="pes_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="pes_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="pes_files/libs/core-js-2.5.3/shim.min.js"></script>
<script src="pes_files/libs/react-17.0.0/react.min.js"></script>
<script src="pes_files/libs/react-17.0.0/react-dom.min.js"></script>
<script src="pes_files/libs/reactwidget-1.0.0/react-tools.js"></script>
<script src="pes_files/libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="pes_files/libs/reactable-binding-0.2.3.9000/reactable.js"></script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#pes-matching-process" id="toc-pes-matching-process" class="nav-link active" data-scroll-target="#pes-matching-process">PES Matching Process</a></li>
  <li><a href="#loading-the-data" id="toc-loading-the-data" class="nav-link" data-scroll-target="#loading-the-data">Loading the data</a></li>
  <li><a href="#the-pes-dataset" id="toc-the-pes-dataset" class="nav-link" data-scroll-target="#the-pes-dataset">The PES Dataset</a></li>
  <li><a href="#household-matching---level-1" id="toc-household-matching---level-1" class="nav-link" data-scroll-target="#household-matching---level-1">Household matching - Level 1</a>
  <ul class="collapse">
  <li><a href="#preprocessing" id="toc-preprocessing" class="nav-link" data-scroll-target="#preprocessing">Preprocessing</a></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation">Implementation</a></li>
  <li><a href="#code-walkthrough-optional" id="toc-code-walkthrough-optional" class="nav-link" data-scroll-target="#code-walkthrough-optional">Code Walkthrough (optional)</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  </ul></li>
  <li><a href="#household-matching---level-2" id="toc-household-matching---level-2" class="nav-link" data-scroll-target="#household-matching---level-2">Household Matching - Level 2</a>
  <ul class="collapse">
  <li><a href="#preprocessing-1" id="toc-preprocessing-1" class="nav-link" data-scroll-target="#preprocessing-1">Preprocessing</a></li>
  <li><a href="#implementation-1" id="toc-implementation-1" class="nav-link" data-scroll-target="#implementation-1">Implementation</a></li>
  <li><a href="#code-walkthrough-optional-1" id="toc-code-walkthrough-optional-1" class="nav-link" data-scroll-target="#code-walkthrough-optional-1">Code Walkthrough (optional)</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">PES Matching</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="pes-matching-process" class="level2">
<h2 class="anchored" data-anchor-id="pes-matching-process">PES Matching Process</h2>
<p>This document explains the process used to perform household-level and individual-level matching for the 2023 Post-Enumeration Survey, which took place in the months of August-September 2023 as a quality assurance and coverage estimate exercise for the Belize 2022 Population and Housing Census.</p>
<p>To perform the matchings, the general guidelines set out by PES consultant Armando Levinson were followed. However, the implementation for the matching was original. This is one of the first automated systems for PES matching that are known, and the rest of the document will summarize the methods and algorithm.</p>
<p>The original guidelines called for a resource-intensive matching process, in which teams of matchers, reviewers and matching-supervisors are all involved in both household and individual level-matching. Nevertheless, in light of limited resources, the SIB team attempted to abstract, program and automate as much of the process as possible. There were no manual matchers, reviewers, or match supervisors - although there was a manual review and verification mechanism automated through a real-time web dashboard.</p>
<p>The resulting matching program and dashboard were immensely helpful and extremely promising. Although not perfectt (there is certainly always the need for a manual inspection and verification step), the SIB team believes considers the automated matching a success and one that be further improved and refined to become an invaluable tool for PES exercises in the future.</p>
</section>
<section id="loading-the-data" class="level2">
<h2 class="anchored" data-anchor-id="loading-the-data">Loading the data</h2>
<p>Before we can get into the nitty-gritty of matching, we first need to do some preparation. This includes loading our PES data and Census data and preparing them for matching.</p>
<p>First, we load our datasets by fetching them from our database server. The details behind accessing this data are not important for the purpose this document, but we do show the code snippet that fetches the data below.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load PES datasets</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>pes_b <span class="ot">&lt;-</span> <span class="fu">fetchWholeTable</span>(<span class="st">'pes_buildings'</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>pes_u <span class="ot">&lt;-</span> <span class="fu">fetchWholeTable</span>(<span class="st">'pes_units'</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>pes_hh <span class="ot">&lt;-</span> <span class="fu">fetchWholeTable</span>(<span class="st">'pes_households'</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>pes_ind <span class="ot">&lt;-</span> <span class="fu">fetchWholeTable</span>(<span class="st">'pes_individuals'</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>pes_out <span class="ot">&lt;-</span> <span class="fu">fetchWholeTable</span>(<span class="st">'pes_outmovers'</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#load CENSUS datasets</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>cen_hh <span class="ot">&lt;-</span> <span class="fu">fetchQuery</span>(census_hh_query)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>cen_ind <span class="ot">&lt;-</span> <span class="fu">fetchQuery</span>(census_ind_query)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="the-pes-dataset" class="level2">
<h2 class="anchored" data-anchor-id="the-pes-dataset">The PES Dataset</h2>
<p>The PES dataset had a total of</p>
<ul>
<li><p>92 total enumeration districts, or EDs</p></li>
<li><p>8892 listed households</p></li>
<li><p>6994 households with a result of “Complete” or “Partially Complete”</p></li>
</ul>
<p>The table below shows the total number of complete/partial households within each district and urban/rural area</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># completed household counts crosstab (district, urban/rural) </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>table <span class="ot">&lt;-</span> pes_hh <span class="sc">|&gt;</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(FINALRESULT <span class="sc">==</span> <span class="st">'Completed'</span>)  <span class="sc">|&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(region, urban_rural) <span class="sc">|&gt;</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_totals</span>(<span class="fu">c</span>(<span class="st">'row'</span>, <span class="st">'col'</span>))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># output a nice table</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">reactable</span>(table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="htmlwidget-c88c3c20541c39711de3" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c88c3c20541c39711de3">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"region":["Belize North","Belize South","Belmopan","Cayo","Orange Walk","Stann Creek","Toledo","Total"],"Rural":[433,538,952,136,99,887,627,3672],"Urban":[783,1579,401,207,81,46,159,3256],"Total":[1216,2117,1353,343,180,933,786,6928]},"columns":[{"accessor":"region","name":"region","type":"character"},{"accessor":"Rural","name":"Rural","type":"numeric"},{"accessor":"Urban","name":"Urban","type":"numeric"},{"accessor":"Total","name":"Total","type":"numeric"}],"defaultPageSize":10,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"594bd5e8e1b6ccf4c08108874471a001"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="household-matching---level-1" class="level2">
<h2 class="anchored" data-anchor-id="household-matching---level-1">Household matching - Level 1</h2>
<p>The first level of household matching was also known as <em>Level-1 Matching</em>, or <em>Direct Matching</em>. <strong>The broad goal in this step was to quickly identify the easy matches</strong>: household-pairs in the same physical location (ED, block, buiding) that appeared to be the same household after comparing the names in the corresponding household listings. This step was important because we want to identify and exclude as much matches as possible in this “easy” step before moving on to more time-consuming, computationally expensive processes and algorithms.</p>
<p>We first review the household-matching guidelines in the Matching Manual:</p>
<ol type="1">
<li><p>Select an EA and identify both Census and PES household questionnaires.</p></li>
<li><p>Perform two-way matching of households based on the following information:</p>
<ol type="i">
<li><p>Geography: District, ED, Block, and Building numbers match.</p></li>
<li><p>Name of the household head: Name matches, allowingfor minor spelling mistakes that do not change the pronunciation.</p></li>
<li><p>Name of household members: Name of at least 1 other household member matches, allowing for minor spelling mistakes that do not change the pronunciation.</p></li>
</ol></li>
<li><p>The previous steps may be relaxed if no immediate match is found.</p>
<ul>
<li><p>For example, the building number or even block number do not need to match if all other household items (name of head and members match).</p></li>
<li><p>Similarly, the head might vary between PES and Census, so matching must account for this as well.</p></li>
<li><p>If a PES-Census household match cannot be found within a EA, the search can extend to the surrounding EAs or even nationally. 5124</p></li>
</ul></li>
</ol>
<section id="preprocessing" class="level3">
<h3 class="anchored" data-anchor-id="preprocessing">Preprocessing</h3>
<p>To ready the datasets for name-based matching, we first do some cleanup and preparation. In order to be able to more accurately compare the listed household members in the PES and Census households, the following preparation was done in each dataset:</p>
<ol type="1">
<li><p>Member names were sorted based on the following variables:</p>
<ul>
<li><p>Age</p></li>
<li><p>Sex</p></li>
</ul></li>
<li><p>This sorting would, in most cases, ensure that the members would be in the same order in both the PES and Census household listings.</p></li>
<li><p>The last name of the listed head of the household was also extracted into its own variable, as comparing household based on last names can also be useful.</p></li>
<li><p>Some cleanup was also done within the name columns, to ensure that missing values, such as “NA” or “##N/A##’ are not interpreted as valid name values.</p></li>
</ol>
<p>The code below is used to perform some basic structuring of the Census and PES datasets in order to prepare them for the matching.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select a subset of the census household dataset, only selecting necessary</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># variables for household-level matching</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>cen_with_names <span class="ot">&lt;-</span> cen_hh <span class="sc">|&gt;</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">census_key =</span> interview__key, </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">census_hh_id =</span> interview__id.x,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>         hh_id, </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>         head_name, </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>         ed,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>         sa,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>         buildingID, </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">unit_id =</span> parent_unit,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>         Person1,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>         Person2, </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>         Person3, </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>         Person4, </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>         Person5) <span class="sc">|&gt;</span> </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">census_head =</span> head_name)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># filter out households with empty head names/household listings, and</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co"># derive a new variable to extract and hold the last name</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a> cen_with_names <span class="ot">&lt;-</span> cen_with_names <span class="sc">|&gt;</span> </span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(census_head) <span class="sc">&amp;</span> census_head <span class="sc">!=</span> <span class="st">'##N/A##'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">clast_name =</span> <span class="fu">str_split_fixed</span>(census_head, <span class="st">" "</span>, <span class="at">n =</span> <span class="dv">2</span>)[,<span class="dv">2</span>]</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>         ) </span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co"># replace missing values coded as '##N/A##' with an empty string</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>cen_with_names <span class="ot">&lt;-</span> cen_with_names <span class="sc">|&gt;</span> </span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">modify_if</span>(is.character, <span class="sc">~</span> <span class="fu">str_to_lower</span>(<span class="fu">str_trim</span>(<span class="fu">str_replace_all</span>(.x, <span class="st">'##N/A##'</span>, <span class="st">''</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And we do the same with the PES data</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select a subset of the pes household dataset, only selecting necessary</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># variables used in household-level matching</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>pes_with_names <span class="ot">&lt;-</span> pes_hh <span class="sc">|&gt;</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">pes_key =</span> interview__key, </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">pes_hh_id =</span> interview__id,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>         hh_id, </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>         head_name, </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>         Person1,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>         Person2, </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>         Person3, </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>         Person4,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>         Person5,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>         ed,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>         sa,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>         region,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>         urban_rural</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">|&gt;</span> </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">pes_head =</span> head_name)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co"># filter out households with empty head names/household listings, and</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co"># derive a new variable to extract and hold the last name</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>pes_with_names <span class="ot">&lt;-</span> pes_with_names <span class="sc">|&gt;</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(pes_head) <span class="sc">&amp;</span> pes_head <span class="sc">!=</span> <span class="st">'##N/A##'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">plast_name =</span> <span class="fu">str_split_fixed</span>(pes_head, <span class="st">" "</span>, <span class="at">n =</span> <span class="dv">2</span>)[,<span class="dv">2</span>]</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="co"># replace missing values coded as '##N/A##' with an empty string</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>pes_with_names <span class="ot">&lt;-</span> pes_with_names <span class="sc">|&gt;</span> </span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">modify_if</span>(is.character, <span class="sc">~</span> <span class="fu">str_to_lower</span>(<span class="fu">str_trim</span>(<span class="fu">str_replace_all</span>(.x, <span class="st">'##N/A##'</span>, <span class="st">''</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="implementation" class="level3">
<h3 class="anchored" data-anchor-id="implementation">Implementation</h3>
<p>As previously explained, this first level of matching was a strict, full matching where ALL variables had to match. To pass the Level-1 matching, both the PES and Census household had to coincide exactly on the following variables</p>
<ul>
<li><p>ED number</p></li>
<li><p>Block number</p></li>
<li><p>Building number</p></li>
<li><p>Dwelling number</p></li>
</ul>
<p>This means we are matching households that are EXACTLY in the same geographic location. <em>Furthermore</em>, to establish that the two households are actually the same, the names of the household members was compared. This was done as follows:</p>
<ol type="1">
<li>The name of the head of the household from the CENSUS dataset was identified.</li>
<li>The name of the census head was compared with EACH listed member in the corresponding PES household.</li>
<li>A string comparison function (using the Jaro-Wrinkler string-distance method) was used to obtain a score for each comparison.
<ul>
<li>We will refer to this as the JW score. The higher the score, the closer the two names match.</li>
</ul></li>
<li>If the name of the census head reasonably matched (a JW score 0.7 was established) with any name in the PES listing, then this household was considered a match.</li>
<li>Based on the closeness of the names matched, a confidence score was also given to the match:
<ol type="1">
<li>High - (JW score &gt; 0.9)</li>
<li>Moderate - (JW score &gt; 0.75)</li>
<li>Fair - (JW score &gt;= 0.7)</li>
</ol></li>
<li>The derived confience score was then useful in manual/visual reviews.</li>
</ol>
<p>We would then obtain our level-1 household matches dataset. The following section goes over the R code used to implement the above algorithm.</p>
</section>
<section id="code-walkthrough-optional" class="level3">
<h3 class="anchored" data-anchor-id="code-walkthrough-optional">Code Walkthrough (optional)</h3>
<p>In the code below, we implement the previous algorithm by first joining the two datasets based on a unique household identifier <code>hh_id</code>. This ensures a 1-1 household match at the geographic level (each physical household in the PES will be matched to its corresponding physical household in the Census, if exists). Then, we compare the names of the first five persons in each household, using the <code>stringsim</code> function and the Jaro-Winkler method. We obtain a similarity score for each pairwise comparison. We save the results in the object <code>scored_dataset</code>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>scored_dataset <span class="ot">&lt;-</span> pes_with_names <span class="sc">|&gt;</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    cen_with_names,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'hh_id'</span>, <span class="st">'ed'</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">score_head =</span> <span class="fu">stringsim</span>(census_head, pes_head, <span class="at">method =</span> <span class="st">'jw'</span>),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">score_surname =</span> <span class="fu">stringsim</span>(clast_name, plast_name, <span class="at">method =</span> <span class="st">'jw'</span>),</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">score_p1 =</span> <span class="fu">stringsim</span>(Person1.x, Person1.y, <span class="at">method =</span> <span class="st">'jw'</span>),</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">score_p2 =</span> <span class="fu">stringsim</span>(Person2.x, Person2.y, <span class="at">method =</span> <span class="st">'jw'</span>),</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">score_p3 =</span> <span class="fu">stringsim</span>(Person3.x, Person3.y, <span class="at">method =</span> <span class="st">'jw'</span>),</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">score_p4 =</span> <span class="fu">stringsim</span>(Person4.x, Person4.y, <span class="at">method =</span> <span class="st">'jw'</span>),</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">score_p5 =</span> <span class="fu">stringsim</span>(Person5.x, Person5.y, <span class="at">method =</span> <span class="st">'jw'</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>         ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then, we are interested in knowing which pairwise comparison obtained the maximum similarity score. We save this maximum score in a variable called <code>highest</code>. Subsequently, we filter and ONLY keep records where the <code>highest</code> score is greater than 0.7. This means we are only keeping households where at least one pair of household member names were a close match. We save the results in the object <code>temp_matches</code>, as we have one more step to perform.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>temp_matches <span class="ot">&lt;-</span> scored_dataset <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">highest =</span> <span class="fu">max</span>(score_head, </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>              score_surname, </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>              score_p1, </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>              score_p2, </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>              score_p3, </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>              score_p4, </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>              score_p5, </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">na.rm =</span> T)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    highest <span class="sc">&gt;</span> <span class="fl">0.7</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Finally we select the variables that will be relevant for reporting and analysis, and also derive a <code>confidence</code> score for each household match, following the previously outlined rules. The code is somewhat lengthy but it is simple. We finally save the results in the object <code>level1_matches</code>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>level1_matches <span class="ot">&lt;-</span> temp_matches <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    region, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    urban_rural, </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ed, </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    buildingID, </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    unit_id, </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    pes_key, </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    pes_hh_id, </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    pes_head, </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    hh_id,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">pes_lastname =</span> plast_name, </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    census_key, </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    census_hh_id,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    census_head, score_head,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">census_lastname =</span> clast_name,</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">lname_score =</span> score_surname,</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">census_p1 =</span> Person1.y, </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">census_p2 =</span> Person2.y, </span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">census_p3 =</span> Person3.y,  </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">census_p4 =</span> Person4.y,</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">census_p5 =</span> Person5.y,</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    score_p1, </span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    score_p2, </span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    score_p3, </span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    score_p4, </span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    score_p5, </span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_score =</span> highest</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">confidence =</span> <span class="fu">case_when</span>(</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>      score_head <span class="sc">&gt;</span> <span class="fl">0.9</span> <span class="sc">|</span> </span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>        score_p1 <span class="sc">&gt;</span> <span class="fl">0.9</span> <span class="sc">|</span> </span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>        score_p2 <span class="sc">&gt;</span> <span class="fl">0.9</span> <span class="sc">|</span> </span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>        score_p3 <span class="sc">&gt;</span> <span class="fl">0.9</span> <span class="sc">|</span>  </span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>        score_p4 <span class="sc">&gt;</span> <span class="fl">0.9</span> <span class="sc">|</span> </span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>        score_p5 <span class="sc">&gt;</span> <span class="fl">0.9</span> <span class="sc">~</span> <span class="st">"high"</span>,</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>     (score_head <span class="sc">&gt;</span> <span class="fl">0.75</span>  <span class="sc">|</span> </span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>        score_p1 <span class="sc">&gt;</span> <span class="fl">0.9</span> <span class="sc">|</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>        score_p2 <span class="sc">&gt;</span> <span class="fl">0.75</span> <span class="sc">|</span> </span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>        score_p3 <span class="sc">&gt;</span> <span class="fl">0.75</span> <span class="sc">|</span>  </span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>        score_p4 <span class="sc">&gt;</span> <span class="fl">0.75</span> <span class="sc">|</span> </span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>        score_p5 <span class="sc">&gt;</span> <span class="fl">0.75</span>) <span class="sc">&amp;</span> lname_score <span class="sc">&gt;</span> <span class="fl">0.8</span> <span class="sc">~</span> <span class="st">"moderate"</span>,</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"fair"</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="results" class="level3">
<h3 class="anchored" data-anchor-id="results">Results</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>l1_results <span class="ot">&lt;-</span> <span class="fu">fetchWholeTable</span>(<span class="st">'pes_matches_l1'</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>table <span class="ot">&lt;-</span> l1_results <span class="sc">|&gt;</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(region, urban_rural) <span class="sc">|&gt;</span> </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_totals</span>(<span class="fu">c</span>(<span class="st">'row'</span>, <span class="st">'col'</span>))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">reactable</span>(table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="htmlwidget-c6f0077f44bc8cb17e51" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c6f0077f44bc8cb17e51">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"region":["belize north","belize south","belmopan","cayo","orange walk","stann creek","toledo","Total"],"rural":[190,232,452,79,69,382,353,1757],"urban":[247,742,228,97,58,20,76,1468],"Total":[437,974,680,176,127,402,429,3225]},"columns":[{"accessor":"region","name":"region","type":"character"},{"accessor":"rural","name":"rural","type":"numeric"},{"accessor":"urban","name":"urban","type":"numeric"},{"accessor":"Total","name":"Total","type":"numeric"}],"defaultPageSize":10,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"46a8866267330f9790471255e05791f3"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="household-matching---level-2" class="level2">
<h2 class="anchored" data-anchor-id="household-matching---level-2">Household Matching - Level 2</h2>
<p>It is worth noting that the Level-1 matching would only find successful household pairs if both Census and PES households were <em>recorded</em> to be in the exact same physical/geographical location. However, variations in canvassing, and interviewer error could mean that a match was missed due to enumerator error. For example the dwelling or building number were different between datasets, although the household was the same.</p>
<p>In Level-2 matching, we will work with all remaining unmatched households within each ED. At this level, every remaining PES household in the ED will be compared against every remaining Census household in the ED. This means that we will be doing N X M comparisons, where N is the number of unmatched households in the PES ED, and M is the number of unmatched households in the Census dataset.</p>
<p>To find matches, a special record-linkage procedure was used, in conjuction with a machine learning algorithm that was trained using the high-confidence matches from the Level-1 matches.</p>
<section id="preprocessing-1" class="level3">
<h3 class="anchored" data-anchor-id="preprocessing-1">Preprocessing</h3>
<p>To ready the datasets for name-based matching, we first do some cleanup and preparation. In order to be able to more accurately compare the listed household members in the PES and Census households, the following preparation was done in each dataset:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>high_matches <span class="ot">&lt;-</span> level1_matches <span class="sc">|&gt;</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(confidence <span class="sc">==</span> <span class="st">'high'</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>pes_link <span class="ot">&lt;-</span> pes_with_names <span class="sc">|&gt;</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    high_matches <span class="sc">|&gt;</span> <span class="fu">select</span>(hh_id, confidence),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'hh_id'</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(confidence) <span class="sc">~</span> hh_id</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, hh_id, ed, sa, <span class="at">head =</span> pes_head, Person1, Person2, Person3, Person4, Person5, <span class="at">last_name =</span> plast_name)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>census_link <span class="ot">&lt;-</span> cen_with_names <span class="sc">|&gt;</span> </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    high_matches <span class="sc">|&gt;</span> <span class="fu">select</span>(hh_id, confidence),</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'hh_id'</span>)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(confidence) <span class="sc">~</span> hh_id</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, hh_id, ed, sa, <span class="at">head =</span> census_head, Person1, Person2, Person3, Person4, Person5, <span class="at">last_name =</span> clast_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="implementation-1" class="level3">
<h3 class="anchored" data-anchor-id="implementation-1">Implementation</h3>
<ol type="1">
<li><p>We will use a specialized record-linkage package named <code>reclin2</code> in order to perform the within-ED comparisons.</p></li>
<li><p>We will use a <strong>random forest</strong> machine-learning algorithm to help us determine matches.</p></li>
</ol>
<p>The sections that follow explain this approach in more detail.</p>
<p>We would then obtain our level-1 household matches dataset. The following section goes over the R code used to implement the above algorithm.</p>
</section>
<section id="code-walkthrough-optional-1" class="level3">
<h3 class="anchored" data-anchor-id="code-walkthrough-optional-1">Code Walkthrough (optional)</h3>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>